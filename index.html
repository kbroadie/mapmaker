<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coachella Valley Map Tool</title>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #1a1a1a; color: #ffffff; height: 100vh; overflow: hidden; }
        #app { display: flex; height: 100vh; }
        #map { flex-grow: 1; height: 100%; }
        #control-panel { width: 320px; background: #2d2d2d; padding: 1rem; overflow-y: auto; }
        .panel-header { display: flex; align-items: center; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid #404040; }
        .panel-header h2 { margin-left: 0.5rem; font-size: 1.25rem; }
        .layer-list { display: flex; flex-direction: column; gap: 0.5rem; }
        .layer-item { background: #404040; border-radius: 0.5rem; padding: 0.75rem; cursor: move; }
        .layer-item.sortable-ghost { opacity: 0.5; }
        .layer-header { display: flex; justify-content: space-between; align-items: center; }
        .layer-controls { display: flex; gap: 0.5rem; }
        .btn { background: transparent; border: none; color: #ffffff; padding: 0.25rem; border-radius: 0.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn:hover { background: #505050; }
        .btn.danger:hover { background: #dc2626; }
        #add-layer-btn { width: 100%; background: #2563eb; color: white; padding: 0.5rem; border: none; border-radius: 0.5rem; margin-top: 1rem; cursor: pointer; font-size: 1rem; }
        #add-layer-btn:hover { background: #1d4ed8; }
        .mapboxgl-ctrl-bottom-left, .mapboxgl-ctrl-bottom-right { display: none; }
        .feather { width: 16px; height: 16px; }
        .mapboxgl-ctrl-group { background: #2d2d2d !important; }
        .mapboxgl-ctrl-group button { border-color: #404040 !important; }
        .mapboxgl-ctrl-group button .mapboxgl-ctrl-icon { filter: invert(1); }
        #style-buttons { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .style-btn { background: #404040; border: none; color: white; padding: 0.5rem; border-radius: 0.5rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; }
        .style-btn:hover { background: #505050; }
        .style-btn.active { background: #2563eb; }
        .style-btn i { width: 16px; height: 16px; }
        #map-controls { display: flex; gap: 0.5rem; margin: 1rem 0; }
        .map-control-btn { background: #404040; color: white; border: none; padding: 0.5rem; border-radius: 0.5rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .map-control-btn:hover { background: #505050; }
        #zoom-controls { display: flex; gap: 0.5rem; align-items: center; background: #404040; border-radius: 0.5rem; padding: 0.25rem; }
    </style>
</head>
<body>
    <div id="app">
        <div id="map"></div>
        <div id="control-panel">
            <div class="panel-content">
                <h2>Layers</h2>
                <div id="layer-list"></div>
                <button id="add-layer-btn">Add Layer</button>
            </div>
            <div class="controls-footer">
                <div id="map-controls">
                    <button class="map-control-btn" id="zoom-in"><i data-feather="plus"></i></button>
                    <button class="map-control-btn" id="zoom-out"><i data-feather="minus"></i></button>
                    <button class="map-control-btn" id="compass"><i data-feather="compass"></i></button>
                </div>
                <div id="style-buttons">
                    <button class="style-btn active" data-style="mapbox://styles/kbroadie/clue0xuxn002x01pw8bt891lt"><i data-feather="map"></i>Default</button>
                    <button class="style-btn" data-style="mapbox://styles/mapbox/dark-v11"><i data-feather="moon"></i>Dark</button>
                    <button class="style-btn" data-style="mapbox://styles/mapbox/light-v11"><i data-feather="sun"></i>Light</button>
                    <button class="style-btn" data-style="mapbox://styles/mapbox/satellite-v9"><i data-feather="image"></i>Satellite</button>
                    <button class="style-btn" data-style="mapbox://styles/mapbox/satellite-streets-v12"><i data-feather="layers"></i>Hybrid</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        mapboxgl.config.SEND_EVENTS = false;
        mapboxgl.accessToken = 'pk.eyJ1Ijoia2Jyb2FkaWUiLCJhIjoiY2p0cmUxdmt4MG1oZjQ0cWdqc3psdzhidCJ9.CDd0msnMnkz4z3wk1zrdEw';
        const COACHELLA_VALLEY_CENTER = [-116.3731, 33.7222];
        const DEFAULT_ZOOM = 11;
        const COACHELLA_CITIES = ['DESERT HOT SPRINGS', 'PALM SPRINGS', 'CATHEDRAL CITY', 'RANCHO MIRAGE', 'PALM DESERT', 'INDIAN WELLS', 'LA QUINTA', 'INDIO', 'COACHELLA'];
        const cityColors = {
            'DESERT HOT SPRINGS': '#4A90E2',
            'PALM SPRINGS': '#FF5733',
            'CATHEDRAL CITY': '#33FF57',
            'RANCHO MIRAGE': '#5733FF',
            'PALM DESERT': '#FF33F5',
            'INDIAN WELLS': '#33FFF5',
            'LA QUINTA': '#F5FF33',
            'INDIO': '#FF3333',
            'COACHELLA': '#33FF33'
        };
        let layers = [];
        const map = new mapboxgl.Map({container: 'map', style: 'mapbox://styles/kbroadie/clue0xuxn002x01pw8bt891lt', center: COACHELLA_VALLEY_CENTER, zoom: DEFAULT_ZOOM});
        function toTitleCase(str) {
            return str.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ');
        }
        function loadCityBoundaries() {
            // Clear existing layers
            layers = [];
            // Add each city as a layer (even without geometry for now)
            COACHELLA_CITIES.forEach(cityName => {
                layers.push({
                    id: `boundary-${cityName.toLowerCase().replace(/\s+/g, '-')}`,
                    name: toTitleCase(cityName),
                    visible: true
                });
            });
            renderLayers();
            return Promise.resolve();
        }
        function toggleLayerVisibility(layerId) { const layer = layers.find(l => l.id === layerId); if (layer) { layer.visible = !layer.visible; map.setLayoutProperty(layerId, 'visibility', layer.visible ? 'visible' : 'none'); renderLayers(); } }
        function removeLayer(layerId) { layers = layers.filter(layer => layer.id !== layerId); if (map.getLayer(layerId)) { map.removeLayer(layerId); map.removeSource(layerId); } renderLayers(); }
        function renderLayers() { const layerList = document.getElementById('layer-list'); layerList.innerHTML = layers.map(layer => `<div class="layer-item" data-id="${layer.id}"><div class="layer-header"><span>${layer.name}</span><div class="layer-controls"><button class="btn" onclick="toggleLayerVisibility('${layer.id}')"><i data-feather="${layer.visible ? 'eye' : 'eye-off'}"></i></button><button class="btn danger" onclick="removeLayer('${layer.id}')"><i data-feather="trash-2"></i></button></div></div></div>`).join(''); feather.replace(); initSortable(); }
        function initSortable() { new Sortable(document.getElementById('layer-list'), {animation: 150, onEnd: function(evt) { const layerId = evt.item.getAttribute('data-id'); const oldIndex = evt.oldIndex; const newIndex = evt.newIndex; const layer = layers.splice(oldIndex, 1)[0]; layers.splice(newIndex, 0, layer); updateMapLayerOrder(); }}); }
        function updateMapLayerOrder() { layers.forEach((layer, index) => { if (map.getLayer(layer.id)) map.moveLayer(layer.id); }); }
        document.addEventListener('DOMContentLoaded', function() { 
            feather.replace();
            map.on('load', () => loadCityBoundaries().then(() => feather.replace()));
            document.getElementById('zoom-in').addEventListener('click', () => map.zoomIn());
            document.getElementById('zoom-out').addEventListener('click', () => map.zoomOut());
            document.getElementById('compass').addEventListener('click', () => map.resetNorth());
            document.querySelectorAll('.style-btn').forEach(button => { button.addEventListener('click', (e) => { const style = button.getAttribute('data-style'); map.setStyle(style); document.querySelectorAll('.style-btn').forEach(btn => btn.classList.remove('active')); button.classList.add('active'); map.once('style.load', () => loadCityBoundaries().then(() => feather.replace())); }); });
        });
    </script>
</body>
</html>
